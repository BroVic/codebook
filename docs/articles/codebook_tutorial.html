<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Codebook tutorial • codebook</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Codebook tutorial">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">codebook</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/codebook.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/codebook_labelled_manual.html">Codebook example with manual labelling</a>
    </li>
    <li>
      <a href="../articles/codebook_nested_scale.html">Codebook example with nested scales</a>
    </li>
    <li>
      <a href="../articles/codebook_qualtrics.html">Codebook example with Qualtrics dataset</a>
    </li>
    <li>
      <a href="../articles/codebook_sav.html">Codebook example with SPSS dataset</a>
    </li>
    <li>
      <a href="../articles/codebook_tutorial.html">Codebook tutorial</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rubenarslan/codebook">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><link href="codebook_tutorial_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="codebook_tutorial_files/pagedtable-1.1/js/pagedtable.js"></script><script src="codebook_tutorial_files/htmlwidgets-1.3/htmlwidgets.js"></script><script src="codebook_tutorial_files/jquery-1.12.4/jquery.min.js"></script><link href="codebook_tutorial_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="codebook_tutorial_files/datatables-binding-0.5/datatables.js"></script><link href="codebook_tutorial_files/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="codebook_tutorial_files/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="codebook_tutorial_files/dt-core-1.10.16/js/jquery.dataTables.min.js"></script><script src="codebook_tutorial_files/jszip-1.10.16/jszip.min.js"></script><script src="codebook_tutorial_files/pdfmake-1.10.16/pdfmake.min.js"></script><script src="codebook_tutorial_files/pdfmake-1.10.16/vfs_fonts.js"></script><link href="codebook_tutorial_files/dt-ext-buttons-1.10.16/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="codebook_tutorial_files/dt-ext-buttons-1.10.16/js/dataTables.buttons.min.js"></script><script src="codebook_tutorial_files/dt-ext-buttons-1.10.16/js/buttons.flash.min.js"></script><script src="codebook_tutorial_files/dt-ext-buttons-1.10.16/js/buttons.html5.min.js"></script><script src="codebook_tutorial_files/dt-ext-buttons-1.10.16/js/buttons.colVis.min.js"></script><script src="codebook_tutorial_files/dt-ext-buttons-1.10.16/js/buttons.print.min.js"></script><link href="codebook_tutorial_files/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="codebook_tutorial_files/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="codebook_tutorial_files/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="codebook_tutorial_files/selectize-0.12.0/selectize.min.js"></script><link href="codebook_tutorial_files/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet">
<script src="codebook_tutorial_files/crosstalk-1.0.0/js/crosstalk.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Codebook tutorial</h1>
                        <h4 class="author">Ruben Arslan</h4>
            
            <h4 class="date">2018-11-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rubenarslan/codebook/blob/master/vignettes/codebook_tutorial.Rmd"><code>vignettes/codebook_tutorial.Rmd</code></a></small>
      <div class="hidden name"><code>codebook_tutorial.Rmd</code></div>

    </div>

    
    
<style>
body {
text-align: justify}
</style>
<p>Using the codebook package locally in RStudio</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">knitr<span class="op">::</span>opts_chunk<span class="op">$</span><span class="kw">set</span>(</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  <span class="dt">warning =</span> <span class="ot">TRUE</span>, <span class="co"># show warnings during codebook generation</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">  <span class="dt">message =</span> <span class="ot">TRUE</span>, <span class="co"># show messages during codebook generation</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  <span class="dt">error =</span> <span class="ot">TRUE</span>, <span class="co"># do not interrupt codebook generation in case of errors,</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">                <span class="co"># usually better for debugging</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  <span class="dt">echo =</span> <span class="ot">TRUE</span>  <span class="co"># show R code</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span>(ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>())</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">pander<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/pander/topics/panderOptions">panderOptions</a></span>(<span class="st">"table.split.table"</span>, <span class="ot">Inf</span>)</a></code></pre></div>
<div id="loading-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-data" class="anchor"></a>Loading data</h2>
<p>So, let us load some data. In this Tutorial, I will walk you through by using the “bfi” dataset made available in the psych package (Revelle et al. 2010; Revelle et al. 2016; Goldberg and Others 1999). The bfi dataset is already very well-documented in the psych R package, but using the codebook, we can add automatically computed reliabilities, graphs, and machine-readable metadata to the mix. The dataset is already available in R, but this will not usually be the case. Therefore, I have uploaded it to the Open Science Framework where you can also find many other publicly available datasets. A new package in R, rio (Chan and Leeper 2018), makes loading data from websites as easy as loading local data. You can import the dataset directly from the Open Science Framework by writing</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(codebook)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">codebook_data &lt;-<span class="st"> </span>rio<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rio/topics/import">import</a></span>(<span class="st">"https://osf.io/s87kd/download"</span>, <span class="st">"csv"</span>)</a></code></pre></div>
<p>Rmarkdown documents have to be reproducible and self-contained. Therefore, it is not enough for a dataset to be loaded locally, you have to load the dataset at the beginning of the document. We can also use the document interactively, although this will not work so well for the codebook package. To see how this works, execute the line you just added by pressing Command + Enter (if you are on a Mac) or Ctrl + Enter (on other platforms).</p>
<p>Did it work? RStudio has a nice data viewer you can use to check. In the environment tab on the top right, you should see “codebook_data”. Click that row. A spreadsheet view of the dataset opens in RStudio. As you can see, it is pretty uninformative. Just long columns of numbers with variable names like A4. Are we talking aggressiveness, agreeableness, or the German industrial norm for paper size? The lack of useful metadata is palpable. What can the codebook package do with this? Click the Knit button again. This time, it will take longer. Once the result is shown in the viewer tab, scroll through it. You can see that a few warnings let us know that the package saw items that might form part of a scale, but there was no aggregated scale. You will also see graphs of the distribution for each item and summary statistics.</p>
</div>
<div id="adding-and-changing-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-and-changing-metadata" class="anchor"></a>Adding and changing metadata</h2>
<div id="variable-labels" class="section level3">
<h3 class="hasAnchor">
<a href="#variable-labels" class="anchor"></a>Variable labels</h3>
<p>The last codebook we generated could already be useful if the variables had meaningful names and self-explanatory values. Yet, this is not often the case. What we need is more metadata: labels for variables and values, a dataset description, and so on. The codebook package can use metadata that are stored in R attributes. So, what are attributes and how do metadata get there? Attributes in R are most commonly used to store the type of a variable. A datetime in R is just a number with two attributes (a time zone and a class). However, these attributes can just as easily store other metadata. The Hmisc (Harrell, 2018), haven (Wickham &amp; Miller, 2018), and rio (Chan &amp; Leeper, 2018) packages, for example, use them to store labels. The haven and rio packages set these attributes when importing data from SPSS or Stata files. However, it is also easily possible to add metadata ourselves:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/attributes">attributes</a></span>(codebook_data<span class="op">$</span>C5)<span class="op">$</span>label &lt;-<span class="st"> "Waste my time."</span></a></code></pre></div>
<p>Here, we assigned a new label to a variable. Because it is inconvenient to write the above repeatedly, the labelled package (Larmarange, 2018) adds a few convenience functions. Load the labelled package, by writing the following in your codebook.rmd.</p>
<p>Now, let us label the C5 item.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(labelled)</a></code></pre></div>
<pre><code>## 
## LABELLED 2.0.0: BREAKING CHANGE
## 
## Following version 2.0.0 of `haven`, `labelled()` and `labelled_spss()` now produce objects with class 'haven_labelled' and 'haven_labelled_spss', due to conflict between the previous 'labelled' class and the 'labelled' class used by `Hmisc`.
## 
## A new function `update_labelled()` could be used to convert data imported with an older version of `haven`/`labelled` to the new classes.</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/labelled/topics/var_label">var_label</a></span>(codebook_data<span class="op">$</span>C5) &lt;-<span class="st"> "Waste my time."</span></a></code></pre></div>
<p>We can also label values in this manner:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/labelled/topics/val_labels">val_labels</a></span>(codebook_data<span class="op">$</span>C1) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Very Inaccurate"</span> =<span class="st"> </span><span class="dv">1</span>, <span class="st">"Very Accurate"</span> =<span class="st"> </span><span class="dv">6</span>)</a></code></pre></div>
<p>Write these labelling commands after loading the dataset and click “Knit” again. As you can now see in the viewer pane, the C1 variable has gained a label at the top and the lowest and highest values on the X axis are now labelled too. If the prospect of adding such labels for every single variable in this way seems tedious, do not worry. Many researchers already have a codebook in the form of a spreadsheet and want to import this. The bfi dataset in the psych package is a good example of this, because it comes with a tabular dictionary. On the line after loading the bfi data, type the following to import the data dictionary.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">dict &lt;-<span class="st"> </span>rio<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rio/topics/import">import</a></span>(<span class="st">"https://osf.io/cs678/download"</span>, <span class="st">"csv"</span>)</a></code></pre></div>
<p>To see what you just loaded, click the “dict” row in the environment tab in the top right panel. As you can see, the dictionary has information on the constructs on which this item loads and on the direction with which it should load on the construct. Let us now make these metadata usable by the codebook package. We will often need to slightly reshape data to help us do this. To make this easier, we will use the suite of packages called the tidyverse. Load them by typing the following.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a></code></pre></div>
<p>Now, we want to use the variable labels that are already in the dictionary. Because we want to label many variables at once, we need a list of variable labels. Instead of assigning one label to one variable as above, we assign many labels to the whole dataset from a named list. Here, each element of the list is one item that we want to label.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/labelled/topics/var_label">var_label</a></span>(codebook_data) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">        <span class="dt">C5 =</span> <span class="st">"Waste my time."</span>, </a>
<a class="sourceLine" id="cb10-3" data-line-number="3">        <span class="dt">C1 =</span> <span class="st">"Am exacting in my work."</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4">)</a></code></pre></div>
<p>But we already have a list of variables and labels in our data dictionary that we can use, so we do not have to tediously write out this list. We have to slightly reshape it though, because right now, it is in the form of a rectangular data frame, not a named list. To do so, we use a convenience function from the codebook function called dict_to_list. This function expects to receive a data frame with two columns, the first should be the variable names, the second the variable labels. To select these columns, we use the select function from the tidyverse packages. We also use a special operator, called a pipe, which looks like this %&gt;%. It allows us to write R code from left to right, passing along the thing we are working on. This allows us to read the code below almost like an English sentence. We take the dict dataset, then we select the variable and label columns, then we use the dict_to_list function. We assign the result of this operation to become the variable labels of codebook_data. Add the following line after importing the dictionary.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/labelled/topics/var_label">var_label</a></span>(codebook_data) &lt;-<span class="st"> </span>dict <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(variable, label) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/list_to_dict.html">dict_to_list</a></span>()</a></code></pre></div>
<p>Did it work? Click codebook_data in the Environment tab again. You should see the variable labels below the variable names now. You can also click Knit again, and you will see that your codebook now contains the variable labels. They are both part of the plots and part of the codebook table at the end. You cannot see this, but they are also part of the metadata that can be found using, for example, Google Dataset Search.</p>
</div>
<div id="value-labels" class="section level3">
<h3 class="hasAnchor">
<a href="#value-labels" class="anchor"></a>Value labels</h3>
<p>So far, so good. But, you may have noticed that education is simply a number. Are these years of education? The average is 3, so that does not seem likely. No, these are actually levels of education. In the dict data frame, you can see, that there are are value labels for the levels of this variable. However, these levels of education are abbreviated, and you can probably imagine that it would be hard for an automated program to understand how these map to the values in our dataset. So, let us try to do a little better. We again use a function from the labelled package, but this time it is not var_label, but val_labels. And unlike var_label, it expects not just one label, but a named vector, with a name for each value that you want to label. You do not need to label all. Named vectors are created using the c() function. Add the following lines right after the last one.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/labelled/topics/val_labels">val_labels</a></span>(codebook_data<span class="op">$</span>gender) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"male"</span> =<span class="st"> </span><span class="dv">1</span>, <span class="st">"female"</span> =<span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/labelled/topics/val_labels">val_labels</a></span>(codebook_data<span class="op">$</span>education) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"in high school"</span> =<span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">   <span class="st">"finished high school"</span> =<span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">              <span class="st">"some college"</span> =<span class="st"> </span><span class="dv">3</span>, </a>
<a class="sourceLine" id="cb12-5" data-line-number="5">               <span class="st">"college graduate"</span> =<span class="st"> </span><span class="dv">4</span>, </a>
<a class="sourceLine" id="cb12-6" data-line-number="6">              <span class="st">"graduate degree"</span> =<span class="st"> </span><span class="dv">5</span>)</a></code></pre></div>
<p>Did it work? Click the Knit button to find out. If it worked, the bars in the graphs for education and gender should now be labelled.</p>
<p>Now, on to the many Likert items. They all have the same value labels. We could assign them the same way as we did for gender and education, tediously repeating the lines for each variable, but the lazy programmer prefers a function for such situations. Creating a function is actually really simple. Just pick a name, ideally one to remember it by – I went with add_likert_labels and assign the keyword function followed by two different kinds of parentheses. The first, normal parentheses surround the variable x. The x here is a placeholder for the many variables we plan to use this function for in the next step. Next, we open curly braces to show that we now intend to write out what we plan to do with said variable x. Then, inside the curly braces, we use the val_labels function from above and assign a named vector.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">add_likert_labels &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/labelled/topics/val_labels">val_labels</a></span>(x) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Very Inaccurate"</span> =<span class="st"> </span><span class="dv">1</span>, </a>
<a class="sourceLine" id="cb13-3" data-line-number="3">                  <span class="st">"Moderately Inaccurate"</span> =<span class="st"> </span><span class="dv">2</span>, </a>
<a class="sourceLine" id="cb13-4" data-line-number="4">                  <span class="st">"Slightly Inaccurate"</span> =<span class="st"> </span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">                  <span class="st">"Slightly Accurate"</span> =<span class="st"> </span><span class="dv">4</span>,</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">                  <span class="st">"Moderately Accurate"</span> =<span class="st"> </span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb13-7" data-line-number="7">                  <span class="st">"Very Accurate"</span> =<span class="st"> </span><span class="dv">6</span>)</a>
<a class="sourceLine" id="cb13-8" data-line-number="8">  x</a>
<a class="sourceLine" id="cb13-9" data-line-number="9">}</a></code></pre></div>
<p>A function is just a tool, we have not used it yet. We want to use it only on the Likert items, so we now need a list of them. An easy way is to subset the dict dataframe to only take those variables that are part of the Big6. To do so, we use the filter and pull functions from the dplyr package.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">likert_items &lt;-<span class="st"> </span>dict <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Big6 <span class="op">!=</span><span class="st"> ""</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(variable)</a></code></pre></div>
<p>Now, we want to apply our new function to these items. We again use a function from the dplyr package, called mutate_at. It expects a list of variables and a function to apply to each. We have both! So, we now add value labels to all likert items in the codebook_data.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">codebook_data &lt;-<span class="st"> </span>codebook_data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/summarise_all.html">mutate_at</a></span>(likert_items,  add_likert_labels)</a></code></pre></div>
<p>Did it work? Click Knit again. Now, all items should also have value labels. However, this is pretty repetitive. Can we group the items by the factor that they are supposed to load on? And while we are at it, how can the metadata on keying that is in our dictionary become part of the dataset?</p>
</div>
<div id="adding-scales" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-scales" class="anchor"></a>Adding scales</h3>
<p>The codebook package relies on a simple convention to be able to summarise psychological scales, such as the Big Five dimension extraversion, which are aggregates across several items. You probably aggregated scales before. Below, we assign a new variable, extraversion, to the result of selecting all extraversion items in the data and passing them to the aggregate_and_document_scale function. This function takes the mean of its inputs, and assigns a label to the result, so that we can still tell which variables it is an aggregate of.</p>
<p>First we need to reverse items which negatively load on the Extraversion factor, such as “Don’t talk a lot.”. To do so, I suggest to follow a simple convention already when coming up with names for your items, namely the format scale_numberR (e.g., bfi_extra_1R for a reverse-coded extraversion item, bfi_neuro_2 for a neuroticism item). That way, the analyst always knows how an item relates to a scale. In the data we just imported, this information is encoded in our data dictionary. Let us rename the reverse-coded items, so that we cannot forget about it. Start by grabbing all items with a negative keying from our dictionary with the following lines.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">reversed_items &lt;-<span class="st"> </span>dict <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(Keying <span class="op">==</span><span class="st"> </span><span class="dv">-1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(variable)</a></code></pre></div>
<p>You can see in your environment tab that the names A1, C4, C5, and so on, are now stored in the reversed_items vector. We can now refer to this vector using the rename_at function which applies a function to all variables we list. Here, we use the super simple function add_R which does exactly what its name says.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">codebook_data &lt;-<span class="st"> </span>codebook_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select_all.html">rename_at</a></span>(reversed_items,  add_R)</a></code></pre></div>
<p>Click codebook_data in the environment tab, and you will see that some variables have been renamed to A1R, C4R, C5R, and so on. Now, it could be ambiguous whether the suffix R means “should be reversed before aggregation” or “has already been reversed”. With the help of metadata in the form of labelled values, there is no potential for confusion. We can reverse the underlying values, but keep the value labels right. So, if somebody responded “Very Accurate” that stays the case, but the underlying value will switch from 6 to 1 for a reversed item. Because you usually import data, where this has not yet been done, the codebook package makes it easy to bring the data into this shape. A command using dplyr functions and the reverse_labelled_values function can easily remedy this.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">codebook_data &lt;-<span class="st"> </span>codebook_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/summarise_all.html">mutate_at</a></span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/reexports.html">matches</a></span>(<span class="st">"</span><span class="ch">\\</span><span class="st">dR$"</span>)), reverse_labelled_values)</a></code></pre></div>
All this statement does is find variable names which end with a number (
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#loading-data">Loading data</a></li>
      <li><a href="#adding-and-changing-metadata">Adding and changing metadata</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Ruben Arslan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.2.0.9000.</p>
</div>
      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '0849aaec03e613204f45e1d6da8cff64',
    indexName: 'rubenarslan',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
