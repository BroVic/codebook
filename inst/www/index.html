<!DOCTYPE html>
<html lang="en">
<head>
<title>Codebook generator</title>

<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" />
<script src="underscore-min.js"></script>
<script src="opencpu/jquery-1.10.2.min.js"></script>
<script src="opencpu/opencpu-0.4.js"></script>
<script src="ace/ace.js" type="text/javascript" charset="utf-8"></script>

<script>
$(function(){
  var editor = ace.edit("editor");
  editor.setTheme("ace/theme/monokai");
  editor.getSession().setMode("ace/mode/r");
  editor.setFontSize("14px");

  //This app requires OpenCPU 1.0.1 or higher!
  ocpu.seturl("../R")

  function make_codebook(e){
    $("#make_codebook").prop("disabled", true);

    var req = ocpu.call("render", {
      file: $("#file")[0].files[0],
      text: editor.getSession().getValue()
    }, function(session){
      $("iframe").attr('src', session.getFileURL("codebook.html"));
      $("#download_codebook").attr('href', session.getFileURL("codebook.html")).show();
      $("#download_codebook_pdf").attr('href', session.getFileURL("codebook.pdf")).show();

    }).fail(function(text){
      alert("Error: " + req.responseText);
    }).always(function(){
        $("#make_codebook").prop("disabled", false);
    });
  }

  //init on start
  $("#make_codebook").click(make_codebook);
});
</script>

<style type="text/css" media="screen">
body {
  background-color: #EEE;
}
.all {
  display: flex;
  flex-flow: column;
  height: 100vh;

}
.header {
  flex: 0 1 auto;
}

.rest_of_screen {
  flex: 1 1 auto;
}

#editor {
  min-height: 70vh;
}

iframe {
  border: 0;
  margin: 0;
  background-color: #222;
}

#download_codebook, #download_codebook_pdf {
  display: none;
}

</style>
</head>
<body>
<div class="container-fluid all">
<div class="row header">
  <div class="col-sm-2">
    <h3>Codebook generator</h3>
  </div>
  <div class="col-sm-3">
    <label>SPSS/Stata/RDS File: <input type="file" id="file"></label>
  </div>
  <div class="col-sm-3">
    <button id="make_codebook" type="button" class="btn">Make codebook!</button>
  </div>
  <div class="col-sm-3">
    <a href="#" id="download_codebook">Download codebook HTML</a>
    <a href="#" id="download_codebook_pdf">PDF</a>
  </div>
</div>
<div class="row rest_of_screen">
  <div id="editor" class="col-md-6">---
title: "Codebook"
output:
  html_document:
    toc: true
    toc_depth: 4
    toc_float: true
    code_folding: 'hide'
    self_contained: true
  pdf_document:
    toc: yes
    toc_depth: 4
---

```{r}
knitr::opts_chunk$set(
  warning = TRUE, # show warnings during codebook generation
  message = TRUE, # show messages during codebook generation
  error = TRUE, # do not interrupt codebook generation in case of errors
  echo = TRUE  # show R code
)
ggplot2::theme_set(ggplot2::theme_bw())
pander::panderOptions("table.split.table", Inf)
```


```{r cb}
codebook(codebook_data)
```
</div>
<iframe src="about:blank" class="col-md-6"></iframe>
</div>
</div>
</body>
</html>
